---
title: 总部订单录入初始化
date: 2022-06-09 20:48:28
tags: ['Forecast']
categories: 业务逻辑
password: 199611
---

1. 继承上版本(上周)总部订单录入数据，继承类型范围：`hq_purchase(总部集采)`、`hq_forecast(总部预测)`、`hq_oem(总部OEM) `--仅线下
2. 写入本周分公司预测数据，数量为受限要货数量，类型初始化为branch_forecast(分公司预测)
3. 写入本周商家预测数据，数量为需求数量(demand_qty)，类型为`cust_forecast(商家预测)`，周次整体向前偏移一周，比如商家预测周次为N，写入到总部订单表周次就是N-1 --仅线下
4. 分公司预测和商家预测进行数据平衡调整
   1. 分公司预测类型数据减去在【分公司+机型+周次】维度对应的商家预测类型的数据
   2. 在商家预测类型数据加上和分公司的偏差，维度同上（分公司预测数据-商家预测数据<0的那种数据，相当于商家预测数据减去比分公司预测数据多出来的那部分数据）
   3. 分公司预测类型数据数值小于0的更新成0
   4. 总结：从代码逻辑分析，【分公司+机型+周次】维度分公司预测与商家预测最终数量等于分公司预测数量，且商家预测优先级更高

